<!DOCTYPE html>
<html lang="ko" xmlns:data-th-="http://www.w3.org/1999/xhtml">
<head>
  <meta charset = "UTF-8">
  <title>onemoa mypage</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/onemoa.css" rel="stylesheet">
  <link href="../css/onemoaMypage.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="/onemoa/js/login.js"></script>
  <script src="../js/onemoa.js"></script>
  <style>
    .mypageArea {
      min-height: 60vw;
    }

    p {
      margin-top: -2px;
    }

    #empty {
      text-align: center;
      margin-top: 20%;
    }

    .row {
      padding: 15px 10px;
      border: solid 1px #dbdbe5;
      border-radius: 4px;

      display: inline-block;
      vertical-align: middle;
      -webkit-transform: perspective(1px) translateZ(0);
      transform: perspective(1px) translateZ(0);
      box-shadow: 0 0 1px rgba(0, 0, 0, 0);
      -webkit-transition-duration: 0.3s;
      transition-duration: 0.3s;
      -webkit-transition-property: box-shadow;
      transition-property: box-shadow;

      max-height: 20vw;
      min-height: 12vw;
      width: 15.3vw;
      margin-bottom: 2vw;

      /*max-height: 330px;*/
      /*min-height: 330px;*/
    }
    .row:hover {
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
      background-color: #ffffff;
      opacity: 0.5;
    }

    .row:hover #userBtn {
      display: block;
    }

    .thumbnail {
      horiz-align: center;
      text-align: center;

      /*min-height: 250px;*/
      /*max-width: 200px;*/
    }

    .thumbnail > img {
      height: 10vw;
      width: 100%;
    }

    .row > p {
      margin-top: 0px;
      font-size: 1.2vw;
      margin-bottom: 5px;
      text-align: right;
    }

    .caption > p {
      max-height: 3vw;
      min-height: 3vw;
      margin-top: 5px;
      margin-bottom: 15px;
      font-size: 1.2vw;
      text-align: left;
    }

    .details {
      vertical-align: center;
    }

    .details img {
      margin-top: 1px;
      border: none;
    }

    .details p {
      display: inline;
      margin-top: 0px;
      font-size: 1vw;
    }

    #price > p {
      text-align: right;
      font-size: 1vw;
      margin-top: 0.5vw;
      margin-bottom: 0px;
    }

    .userBtn {
      float: left;
    }

    .tableStyle {
      text-align: center;
    }

  </style>
<body style="overflow-x: hidden">
<div data-th-replace="/fragments/nav.html :: fragment-nav"></div>
<ul class="myPage">
  <li class="mypageArea">
    <div class="nick">
      <img src="../img/profile1.png">
      <p>닉네임님</p>
    </div>
    <div class="mypageNav">
      <div class="myonemoa">
        <p>마이원모아</p>
        <span class="mybar">
      </div>
      <ul class="mynav">
        <li><a href="portfolioList">나의 포트폴리오</a></li>
        <li><a href="">구매관리</a></li>
        <li><a href="">상품관리</a></li>
        <li><a href="">나의 서비스관리</a></li>
        <li><a href="">결제내역</a></li>
        <li><a href="">1:1 문의내역</a></li>
        <li><a href="">계정설정</a></li>
      </ul>
    </div>
  </li>
  <li class="mypageArea">
    <div class="mypagePortfolio">
      <div class="portfolioBoxCon">
        <p class="mptxt2" style="width: 100%">구매관리</p>
        <ul class="portfolioList">
          <div id="empty" data-th-if="${#lists.isEmpty(buys)}"><img data-th-src="@{../img/emptycart.png}" width="20%" height="20%"/>
            <p><br>구매한 상품이 없습니다.</p></div>
          <div data-th-if="${!#lists.isEmpty(buys)}">
          <table class="table">
            <tr>
            <th class="tableStyle">상품번호</th>
            <th class="tableStyle">상품이름</th>
            <th class="tableStyle">판매자</th>
            <th class="tableStyle">결제금액</th>
            <th class="tableStyle">결제일시</th>
            <th class="tableStyle">주문상태</th>
            </tr>
              <tr data-th-each="buy : ${buys}">
                <td class="tableStyle" data-th-text="${buy.product.no}">상품번호들어가요오</td>
                <td class="tableStyle" data-th-text="${buy.product.title}">상품이름들어가요오</td>
                <td class="tableStyle" data-th-text="${buy.product.writer.nickname}">판매한사람</td>
                <td class="tableStyle" data-th-text="${#numbers.formatInteger(buy.product.price, 3, 'COMMA')} + ' 원'">결제금액들어가요오</td>
                <td class="tableStyle" data-th-text="${#temporals.format(buy.createdDate, 'yyyy-MM-dd')}">결제일시들어가요</td>
                <td class="tableStyle" data-th-text="${buy.orderStatus.name}">주문상태들어가요</td>
                <td class="tableStyle" style="border: none;">
                  <button>
                    <a class="userBtn" data-th-id="'review-btn-'+${buy.no}" data-th-onclick="edit([[${buy.no}]])"
                    href="" onclick="openPop()">후기남기기</a>
                  </button>

<!--                  <a href="#" data-th-href="@{/mypage/review/Form(no=${buy.no})}"-->
<!--                     onclick="window.open(this.href, '_blank', 'width=1200, height=1000, top=Math.ceil(( window.outerHeight - 800 )/5) , left=Math.ceil(( window.outerWidth - 800 )/8'); return false;" class="item">-->

                  <!--                  <button class="userBtn" data-th-id="'review-btn-'+${buy.no}" data-th-onclick="edit([[${buy.no}]])">-->
<!--                    <a href="" onclick="openPop()">후기남기기</a></button>-->
                </td>
              </tr>
          </table>
          </div>
        </ul>
      </div>
    </div>
  </li>
</ul>
<script>

  const edit = function (reviewNo) {
    console.log(reviewNo);
    $("review-btn-" + reviewNo).closest("tr").find("button")

   $($("review-btn-" + reviewNo).closest("tr").find("button")).off().click(function (){
     function openPop() {
         window.open('/onemoa/review/Form', '리뷰팝업', 'width=700px,height=800px, scrollbars=yes resizable=no');
       }})};

    //
    // const orderStatus = $("#update-btn-" + saleNo).closest("tr").find("select").val();
    // const orderNo = $("#update-btn-" + saleNo).closest("tr").children('td:eq(0)').attr("value");
    //
    // const winopen function openPop(){
    //     let popup = window.open('/onemoa/review/Form', '리뷰팝업', 'width=700px,height=800px, scrollbars=yes resizable=no');
    //   }}
    //
    // }
    // document.getElementById("userBtn").onclick = function() {myFunction()};
    // function myFunction() {
    //   window.open('/onemoa/review/Form', '리뷰팝업', 'width=700px,height=800px, scrollbars=yes resizable=no');
    // }
    //


    // $("#review-btn-" + reviewNo).off().click(function () {
    //   const orderNo = $("#review-btn-" + buyNo).closest("tr").children('td:eq(0)').attr("value");
    //
    // }
  //
  //     $.ajax({
  //       type: "POST",
  //       url: "/onemoa/mypage/updateStatus",
  //       data: {"orderNo": orderNo, "orderStatus": orderStatus},
  //       success: function (result) {
  //         $("#update-btn-" + saleNo).closest("tr").find("button")
  //         $("#update-btn-" + saleNo).attr("style", "display:block");
  //         $("#save-btn-" + saleNo).attr("style", "display:none");
  //       }
  //     })
  //   });
  // }
  //

</script>
<footer data-th-replace="/fragments/footer.html :: fragment-footer"></footer>
</body>
</html>